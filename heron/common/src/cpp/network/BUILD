package(default_visibility = ["//visibility:public"])

load("/tools/rules/genproto", "proto_library")

cc_library(
    name = "network-cxx",
    srcs = [
        "asyncdns.cpp",
        "baseclient.cpp",
        "baseconnection.cpp",
        "baseserver.cpp",
        "client.cpp",
        "connection.cpp",
        "event_loop_impl.cpp",
        "httpclient.cpp",
        "httpserver.cpp",
        "httputils.cpp",
        "modinit.cpp",
        "networkoptions.cpp",
        "packet.cpp",
        "server.cpp",

        "regevent.h",
        "asyncdns.h",
        "baseclient.h",
        "baseconnection.h",
        "baseserver.h",
        "client.h",
        "connection.h",
        "event_loop.h",
        "httpclient.h",
        "httpserver.h",
        "httputils.h",
        "networkoptions.h",
        "network_error.h",
        "packet.h",
        "event_loop_impl.h",
        "server.h",
        "mempool.h",

        "rdma/heron_rdma_connection.cpp",
        "rdma/heron_rdma_client.cpp",
        "rdma/heron_rdma_server.cpp",
        "rdma/options.cpp",
        "rdma/rdma_packet.cpp",
        "rdma/rdma_base_connection.cpp",
        "rdma/rdma_buffer.cpp",
        "rdma/rdma_client.cpp",
        "rdma/rdma_connection.cpp",
        "rdma/rdma_event_loop.cpp",
        "rdma/rdma_fabric.cpp",
        "rdma/rdma_rdma_channel.cpp",
        "rdma/rdma_rdma.cpp",
        "rdma/rdma_server.cpp",
        "rdma/utils.cpp",

        "rdma/heron_rdma_connection.h",
        "rdma/heron_rdma_client.h",
        "rdma/heron_rdma_server.h",
        "rdma/options.h",
        "rdma/rdma_packet.h",
        "rdma/hps.h",
        "rdma/rdma_channel.h",
        "rdma/rdma_rdm.h",
        "rdma/rdma_base_connection.h",
        "rdma/rdma_buffer.h",
        "rdma/rdma_client.h",
        "rdma/rdma_connection.h",
        "rdma/rdma_event_loop.h",
        "rdma/rdma_fabric.h",
        "rdma/rdma_server.h",
        "rdma/utils.h",
    ],
    hdrs = [
        "network.h",
        "modinit.h",
    ],
    copts = [
        "-Iheron/common/src/cpp",
        "-I$(GENDIR)/heron/common/src/cpp",
    ],
    deps = [
        "//third_party/libevent:libevent-cxx",
        "//heron/common/src/cpp/threads:threads-cxx",
        "//heron/common/src/cpp/errors:errors-cxx",
        "//heron/common/src/cpp/basics:basics-cxx",
        "//third_party/libfabric:libfabric-cxx",
    ],
    linkstatic = 1,
)
